import java.util.Random;

/**
 * Created by lhscompsci on 10/15/15.
 */
public class Board {

    private int BOARD_SIZE = 10;
    private int NUM_MIRRORS = 10;

    private int[][] board;

    // directions
    private static final int UP = -1;
    private static final int DOWN = 1;
    private static final int LEFT = -1;
    private static final int RIGHT = 1;

    // tile ID's
    private static final int EMPTY = 0; // no mirror
    private static final int L_MIRROR = 1; // mirror facing left, not revealed
    private static final int L_MIRROR_R = 2; // mirror facing left, revealed
    private static final int R_MIRROR = 3; // mirror facing right, not revealed
    private static final int R_MIRROR_R = 4; // mirror facing right, revealed

    private static final Random random = new Random();

    public Board() {
        initBoard();
    }

    private void initBoard() {
        board = new int[BOARD_SIZE][BOARD_SIZE];
        int placed_mirrors = 0;
        do {
            int row = random.nextInt(board.length);
            int col = random.nextInt(board[0].length);
            if(board[row][col] == EMPTY) {
                board[row][col] = (random.nextBoolean() ? L_MIRROR : R_MIRROR);
                placed_mirrors++;
            }
        } while(placed_mirrors < NUM_MIRRORS);
    }

    // converts tileID to char on display
    private static char getTile(int tileID) throws IndexOutOfBoundsException {
        switch(tileID) {
            /*case 0:
            case 1:
            case 3:
                return '.';
            case 2:
                return '/';
            case 4:
                return '\\';
            default:
                throw new IndexOutOfBoundsException("Invalid Tile ID");*/
            case EMPTY:
                return '.';
            case L_MIRROR:
            case L_MIRROR_R:
                return '/';
            case R_MIRROR:
            case R_MIRROR_R:
                return '\\';
            default:
                return 'X';
        }
    }

    // board coordinates to screen coordinates of laser
    private int boardToLaser(int row, int col, int dirR, int dirC) {
        if(row < 0) {
            row = 0;
        } else if(row >= BOARD_SIZE) {
            row = BOARD_SIZE - 1;
        }
        if(col < 0) {
            col = 0;
        } else if(col >= BOARD_SIZE) {
            col = BOARD_SIZE - 1;
        }
        if(row == 0 && dirR == UP) { // top row
            return 2 * BOARD_SIZE + col;
        } else if(row == BOARD_SIZE - 1 && dirR == DOWN) { // bottom row
            return col;
        } else if(col == 0 && dirC == LEFT) { // left column
            return 2 * BOARD_SIZE - row - 1;
        } else if(col == BOARD_SIZE - 1 && dirC == RIGHT) { // right column
            return 3 * BOARD_SIZE + row;
        } else {
            return -1;
        }
    }

    // laser number to board coordinates and direction to fire laser
    private int[] laserToBoard(int laser) {
        if(laser < BOARD_SIZE) { // bottom row
            return new int[] { BOARD_SIZE - 1, laser, UP, 0 };
        } else if(laser >= BOARD_SIZE && laser < BOARD_SIZE * 2) { // left column
            return new int[] { BOARD_SIZE - laser % BOARD_SIZE - 1, 0, 0, RIGHT };
        } else if(laser >= 2 * BOARD_SIZE && laser < BOARD_SIZE * 3) { // top row
            return new int[] { 0, laser % BOARD_SIZE, DOWN, 0 };
        } else if(laser >= 3 * BOARD_SIZE && laser < BOARD_SIZE * 4){ // right column
            return new int[] { laser % BOARD_SIZE, BOARD_SIZE - 1, 0, LEFT };
        } else {
            return null;
        }
    }

    public int fireLaser(int laser) {
        int[] info = laserToBoard(laser);
        return fireLaser(info[0], info[1], info[2], info[3]);
    }

    public int fireLaser(int row, int col, int dirR, int dirC) {
        System.out.println(row + "," + col + "," + dirR + "," + dirC);
        if(row <= 0 && dirR == UP || row >= BOARD_SIZE - 1 && dirR == DOWN ||
                col <= 0 && dirC == LEFT || col >= BOARD_SIZE - 1 && dirC == RIGHT) { // edge of board
            return boardToLaser(row, col, dirR, dirC);
        }
        if(board[row][col] == EMPTY) {
            return fireLaser(row + dirR, col + dirC, dirR, dirC);
        } else if(board[row][col] == L_MIRROR || board[row][col] == L_MIRROR_R) { // left-facing mirror "/"
            System.out.println("Left facing mirror" + getTile(L_MIRROR) + " direction = " + dirR + "," + dirC);
            if(dirC == RIGHT) {
                return fireLaser(row + UP, col, UP, 0);
            } else if(dirC == LEFT) {
                return fireLaser(row + DOWN, col, DOWN, 0);
            } else if(dirR == UP) {
                return fireLaser(row, col + RIGHT, 0, RIGHT);
            } else if(dirR == DOWN) {
                return fireLaser(row, col + LEFT, 0, LEFT);
            }
        } else if(board[row][col] == R_MIRROR || board[row][col] == R_MIRROR_R) { // right-facing mirror "\"
            System.out.println("Right facing mirror" + getTile(R_MIRROR) + " direction = " + dirR + "," + dirC);
            if(dirC == RIGHT ) {
                return fireLaser(row + DOWN, col, DOWN, 0);
            } else if(dirC == LEFT) {
                return fireLaser(row + UP, col, UP, 0);
            } else if(dirR == UP) {
                return fireLaser(row, col + LEFT, LEFT, 0);
            } else if(dirR == DOWN) {
                return fireLaser(row, col + RIGHT, RIGHT, 0);
            }
        }
        return -1;
    }

    public void displayBoard() {
        System.out.println("   20212223242526272829   "); // todo: no hardcoding
        for(int i = 0; i < board.length; i++) {
            System.out.print((19 - i) + " ");
            for(int j = 0; j < board[0].length; j++) {
                System.out.print(getTile(board[i][j]) + " ");
            }
            System.out.println(30 + i);
        }
        System.out.println("   0 1 2 3 4 5 6 7 8 9   ");
    }
}
